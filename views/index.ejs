<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Colmena Inteligente üêù</title>
    
    <link rel="stylesheet" href="/css/styles.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

    <header class="dashboard-header">
        <h1>Dashboard Colmena Inteligente üêù</h1>
        <p>Monitoreo en Tiempo Real y Hist√≥rico</p>
    </header>

    <main class="dashboard-container">

    <section class="latest-data-block">
        <h3>Datos m√°s Recientes (Haga clic para ver el hist√≥rico)</h3>
        
        <div class="data-cards-grid"> 
    
    <div class="data-card status-card" id="card-general">
    <p class="card-title">Hist√≥rico y An√°lisis</p>
    <div class="card-status-message">
        <h2 id="general-status-display">Ver Historial de Datos</h2>
    </div>
    <span class="card-time">Alertas Detectadas: <span id="alert-count-summary">--</span></span>
</div>

<div class="data-card weight-card" id="card-weight">
    <p class="card-title">Peso</p>
    <p class="card-value" id="weight-value">-- g</p>
    <span class="card-time" id="weight-time">√öltima actualizaci√≥n: --:--</span>
</div>

<div class="data-card temp-card" id="card-temp">
    <p class="card-title">Temperatura Interna</p>
    <p class="card-value" id="temp-value">-- ¬∞C</p>
    <span class="card-time" id="temp-time">Actualizado: --:--</span>
</div>

<div class="data-card hum-card" id="card-hum">
    <p class="card-title">Humedad Interna</p>
     <p class="card-value" id="hum-value">-- %</p>
    <span class="card-time" id="hum-time">Actualizado: --:--</span>
</div>

<div class="data-card audio-card" id="card-audio">
    <p class="card-title">Ruido (Nivel)</p>
     <p class="card-value" id="audio-value">--</p>
     <span class="card-time" id="audio-time">Actualizado: --:--</span>
</div>

</div>
    </section>

    <section class="history-block">
    <h2 style="margin-bottom: 20px;">Hist√≥rico de Datos y Filtros</h2>
    
    <button class="filter-toggle-btn" id="toggle-filter-btn">
        ‚ò∞ Opciones de Filtrado
    </button>

    <form id="history-filter-form" class="filter-form hidden-mobile">
        <div class="filter-group">
            <label for="start-date">Desde Fecha:</label>
            <input type="date" id="start-date" name="start_date" required>
        </div>
        <div class="filter-group">
            <label for="end-date">Hasta Fecha:</label>
            <input type="date" id="end-date" name="end_date" required>
        </div>
        <div class="filter-group">
            <label for="start-time">Desde Hora:</label>
            <select id="start-time" name="start_time" required></select>
        </div>
        <div class="filter-group">
            <label for="end-time">Hasta Hora:</label>
            <select id="end-time" name="end_time" required></select>
        </div>

        <div class="filter-buttons">
            <button type="submit" class="btn-primary">Aplicar Filtro</button>
            <button type="button" id="reset-filter-btn" class="btn-secondary">Reset</button>
        </div>
    </form>

    <h3 id="chart-title">üìà Hist√≥rico General</h3>
    
    <div class="charts-block">
        <div id="general-chart-container" class="chart-container visible">
            <p>Cargando gr√°fico...</p> 
        </div>
        <div id="weight-chart-container" class="chart-container"></div>
        <div id="temp-individual-chart-container" class="chart-container"></div>
        <div id="hum-individual-chart-container" class="chart-container"></div>
        <div id="audio-individual-chart-container" class="chart-container"></div>
    </div>
</section>
    <section class="status-alerts-block">
        <div class="alert-summary status-initial">
            <h2 id="hive-status-message">Inicializando estado...</h2> 
            <p>√öltima verificaci√≥n: <span id="last-check-time">--:--</span></p>
        </div>
        <div class="alert-details">
            <h3>Detalle de Alertas</h3>
            <ul id="alert-list">
                <li><span class="status-alert-icon">...</span> Cargando umbrales de alerta.</li>
            </ul>
        </div>
    </section>

    <section class="video-block">
        <h2>üé• Streaming en Vivo de la Colmena (Twitch)</h2>
        <iframe 
            src="https://player.twitch.tv/?channel=NOMBRE_DEL_CANAL&parent=localhost" 
            allowfullscreen="true" 
            scrolling="no" 
            title="Hive Stream"
            style="border: none;">
        </iframe>
    </section>

</main>
    <footer class="dashboard-footer">
        <p>&copy; <%= new Date().getFullYear() %> Monitoreo de Colmenas. Desarrollado con Node.js.</p>
    </footer>

    <script src="/js/main.js" type="module"></script>
</body>
</html>